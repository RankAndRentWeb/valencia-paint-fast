---
import Layout from '@/layouts/SiteLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blogs');
const grouped = posts.reduce((acc, p) => {
  const filename = p.id.replace('.md', '');
  const parts = filename.split('/');
  const cat = parts.length === 2 ? parts[0] : 'general';
  const slug = parts.length === 2 ? parts[1] : filename;
  
  (acc[cat] ??= []).push({...p, category: cat, slug: slug});
  return acc;
}, {});
---

<Layout title="Blogs" description="Artículos sobre pintura, gotelé e impermeabilización">
  <section class="container mx-auto py-8">
    <h1 class="text-3xl font-semibold mb-6">Blogs</h1>
    <div class="grid md:grid-cols-2 gap-8">
      {Object.entries(grouped).map(([cat, items]) => (
        <div>
          <h2 class="text-xl font-semibold capitalize mb-2">{cat}</h2>
          <ul class="list-disc pl-5">
            {items.map(p => 
              <li><a href={`/blogs/${p.category}/${p.slug}/`}>{p.data.title}</a></li>
            )}
          </ul>
        </div>
      ))}
    </div>
  </section>
</Layout>