---
import SiteLayout from '../../../layouts/SiteLayout.astro';
import Breadcrumbs from '../../../components/Breadcrumbs.tsx';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const cats = await getCollection('blogCategories');
  return cats.map(c => ({ 
    params: { category: c.data.slug }, 
    props: { cat: c.data } 
  }));
}

const { cat } = Astro.props;
const posts = (await getCollection('blogs')).filter(p => p.slug.startsWith(cat.slug + "/"));
---

<SiteLayout title={`${cat.name} - Blog de Pintura Valencia`} description={cat.description}>
  <div class="container mx-auto px-4">
    <Breadcrumbs items={[{ label: 'Blog', href: '/blog/' }, { label: cat.name }]} client:load />

    <div class="py-12">
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">{cat.name}</h1>
        {cat.description && (
          <p class="text-xl text-muted-foreground max-w-2xl mx-auto">{cat.description}</p>
        )}
      </div>
    </div>
  </div>

  <section class="container mx-auto px-4 pb-12">
    <div class="grid md:grid-cols-2 gap-6">
      {posts.map(p => {
        const [, slug] = p.slug.split("/");
        return (
          <a href={`/blog/${cat.slug}/${slug}/`} class="rounded-xl border p-6 hover:shadow transition block">
            <h2 class="text-lg font-semibold mb-2">{p.data.title}</h2>
            <p class="text-gray-600">{p.data.excerpt}</p>
          </a>
        );
      })}
    </div>
  </section>
</SiteLayout>
